{% extends 'base.html' %}
{% load static %}

{% block title %}My Tasks | To-Do List{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/style.css' %}">
{% endblock %}

{% block content %}


<!-- Background Elements -->
<div class="background-elements">
    <div class="circle circle-1"></div>
    <div class="circle circle-2"></div>
    <div class="circle circle-3"></div>
    <div class="circle circle-4"></div>
</div>

<div class="container mt-4">
    <!-- Header Section -->
    <div class="header-section mb-4">
        <div class="d-flex justify-content-between align-items-center">
            <div class="header-content">
                <h1 class="main-title">
                    <i class="fas fa-tasks me-2"></i>My To-Do List
                </h1>
                <p class="subtitle">Stay organized and productive</p>
            </div>
        </div>
    </div>

    <!-- Stats Section -->
    <div class="stats-section mb-4">
        <div class="row">
            <div class="col-md-3 col-6">
                <div class="stat-card stat-total">
                    <i class="fas fa-list-check"></i>
                    <div class="stat-content">
                        <h3>{{ total_count }}</h3>
                        <p>Total Tasks</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="stat-card stat-pending">
                    <i class="fas fa-clock"></i>
                    <div class="stat-content">
                        <h3>{{ pending_count }}</h3>
                        <p>Pending</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="stat-card stat-completed">
                    <i class="fas fa-check-circle"></i>
                    <div class="stat-content">
                        <h3>{{ completed_count }}</h3>
                        <p>Completed</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3 col-6">
                <div class="stat-card stat-progress">
                    <i class="fas fa-chart-line"></i>
                    <div class="stat-content">
                        <h3>
                            {% if total_count > 0 %}
                            {{ completed_count }}/{{ total_count }}
                            {% else %}
                            0
                            {% endif %}
                        </h3>
                        <p>Progress</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Action Bar -->
    <div class="action-bar mb-4">
        <a href="{% url 'add_task' %}" class="btn-add-task">
            <i class="fas fa-plus"></i> Add New Task
        </a>
        <div class="filter-options">
            <a href="?filter=all" class="filter-btn {% if filter_type == 'all' %}active{% endif %}">All</a>
            <a href="?filter=pending" class="filter-btn {% if filter_type == 'pending' %}active{% endif %}">Pending</a>
            <a href="?filter=completed"
                class="filter-btn {% if filter_type == 'completed' %}active{% endif %}">Completed</a>
        </div>
    </div>

    <!-- Tasks Container -->
    <div class="tasks-container">
        {% if tasks %}
        <div class="row">
            {% for task in tasks %}
            <div class="col-lg-6 mb-4">
                <div class="task-card {% if task.completed %}completed{% endif %}">
                    <div class="task-header">
                        <div class="task-status">
                            {% if task.completed %}
                            <span class="status-badge completed-badge">
                                <i class="fas fa-check"></i> Completed
                            </span>
                            {% else %}
                            <span class="status-badge pending-badge">
                                <i class="fas fa-clock"></i> Pending
                            </span>
                            {% endif %}
                        </div>
                        <div class="task-date">
                            <small><i class="far fa-calendar"></i> {{ task.created_at|date:"M d, Y" }}</small>
                        </div>
                    </div>

                    <div class="task-body">
                        {% if task.completed %}
                        <s class="task-title">{{ task.title }}</s>
                        {% else %}
                        <h4 class="task-title">{{ task.title }}</h4>
                        {% if task.description %}
                        <p class="task-description">{{ task.description|truncatechars:100 }}</p>
                        {% endif %}

                        {% if task.tags %}
                        <div class="task-tags mt-2">
                            {% for tag in task.tags %}
                            <span class="badge bg-light text-dark border me-1">{{ tag }}</span>
                            {% endfor %}
                        </div>
                        {% endif %}
                        {% endif %}
                    </div>

                    {% if not task.completed %}
                    <div class="task-actions">
                        <a href="{% url 'edit_task' task.id %}" class="btn-action btn-edit">
                            <i class="fas fa-edit"></i> Edit
                        </a>
                        <a href="{% url 'complete_task' task.id %}" class="btn-action btn-complete">
                            <i class="fas fa-check"></i> Mark Complete
                        </a>
                        <a href="{% url 'delete_task' task.id %}" class="btn-action btn-delete-final"
                            onclick="return confirm('Are you sure you want to delete this task?');">
                            <i class="fas fa-trash"></i> Delete
                        </a>
                    </div>
                    {% else %}
                    <div class="task-actions completed-actions">
                        <a href="{% url 'delete_task' task.id %}" class="btn-action btn-delete-final"
                            onclick="return confirm('Are you sure you want to delete this task?');">
                            <i class="fas fa-trash"></i> Remove
                        </a>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <!-- Empty State -->
        <div class="empty-state">
            <div class="empty-state-icon">
                <i class="fas fa-clipboard-list"></i>
            </div>
            <h3>No tasks yet</h3>
            <p>Start by adding your first task to get organized!</p>
            <a href="{% url 'add_task' %}" class="btn-add-first">
                <i class="fas fa-plus"></i> Create Your First Task
            </a>
        </div>
        {% endif %}
    </div>
</div>

<!-- Confirmation Modal for Delete -->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Confirm Delete</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this task? This action cannot be undone.
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <a href="#" class="btn btn-danger" id="confirmDeleteBtn">Delete Task</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/task_list.js' %}?v=fix2"></script>
{% endblock %}